<!DOCTYPE html>

<html>
<head>
  
  <title>Simmons/Rooms</title>

  <link href="http://fonts.googleapis.com/css?family=Roboto:300,400,300italic,400italic" rel="stylesheet" type="text/css">
  <link rel="stylesheet" type="text/css" href="css/style.css">
  <link rel="stylesheet" type="text/css" href="css/tipsy.css">

  <script type="text/javascript" src="js/jquery.js"></script>
  <script type='text/javascript' src='js/jquery.tipsy.js'></script>
  <script src="js/allrooms.js" type="text/javascript"></script> 
  <script src="js/svg.js" type="text/javascript"></script>
  <script src="js/floorplan-minimal-svg.js" type="text/javascript"></script>

</head>
<body>

<script type="text/javascript">


/**********************************************
*                                             *
*                   GLOBALS                   *
*                                             *
**********************************************/

// defaults:

var desiredSections = ['23AB', '34C', '4AB', '5AB', '6AB', '56C', '7ABC', '8910A', '8910B', '8910C'];
var desiredCapacity = 'All'; // or 'Double' or 'Single'
var desiredView     = 'All'; // or 'Boston' or 'Cambridge'
var desiredWalls    = 'All'; // or 'Boxy' or 'Curvy'
var desiredBathroom = 'All'; // or 'Shared' or 'Unshared' or 'Private'
var consider = 'All'; // or 'Available'

// Necessary for nice fades when updating svg
var oldRooms = [];


function highlightInSvg(room) {
  $('#r' + room).children('*:first-child').attr("fill", "#53adf9");
  $('#r' + room).children('*:last-child').attr("fill", "#1a7fd5");
}


function unhighlightInSvg(room) {
  $('#r' + room).children('*:first-child').attr("fill", "#FCAF17");
  $('#r' + room).children('*:last-child').attr("fill", "#BB762A");
}

/**********************************************
*                                             *
*              UPDATE FUNCTIONS               *
*                                             *
**********************************************/

function updateCount(newRooms) {
  $(".count").html("Results (" + newRooms.length + ")");
}

function updateList(newRooms) {
  $('.results-list-doubles').empty();
  $('.results-list-singles').empty();

  // SORT BY SIZE
  var sortedNewRooms = [];
  for (var i = 0; i < newRooms.length; i ++) {
    sortedNewRooms.push([newRooms[i], roominfo[newRooms[i]].size ]);
  };
  sortedNewRooms.sort(function(a, b) { return a[1] - b[1] } );
  sortedNewRooms.reverse();

  for (var i = 0; i < sortedNewRooms.length; i ++) {
    var number = sortedNewRooms[i][0]; // [1] is size
    var html = '\
      <div class="item" title="' + number + '">\
        <span class="number">' + number + '</span>\
        <span class="size">' + roominfo[number].size + ' sq. ft.</span>\
      </div>';

    if (roominfo[number].capacity == 'Double') { $('.results-list-doubles').append(html); }
    if (roominfo[number].capacity == 'Single') { $('.results-list-singles').append(html); }
  }

  $('.item').hover(function() {
    highlightInSvg($(this).attr("title"))
  }, function() {
    unhighlightInSvg($(this).attr("title"))
  });

  $('.item').click(function() {
    var room = $(this).attr("title");
    moveTo(room); // floorplan
    // updateOverlay(room);
    // $('.overlay').show();
  });
}

function updateSvg(newRooms) {

  // Fade out rooms that no longer appear in results
  var toFadeOut = [];
  for (var i = 0; i < oldRooms.length; i ++) {
    if (newRooms.indexOf(oldRooms[i]) == -1) {
      toFadeOut.push(oldRooms[i]);
    }
  }
  for (var i = 0; i < toFadeOut.length; i ++) {
    $('#r' + toFadeOut[i]).fadeOut(300);
  }

  // Fade in rooms that newly do appear in results
  var toFadeIn = [];
  for (var i = 0; i < newRooms.length; i ++) {
    if (oldRooms.indexOf(newRooms[i]) == -1) {
      toFadeIn.push(newRooms[i]);
    }
  }
  for (var i = 0; i < toFadeIn.length; i ++) {
    $('#r' + toFadeIn[i]).fadeIn(300);
  }

  // update for next time
  oldRooms = newRooms;
}

function updateFloorplan(newRooms) {
  // hide all
  for (var i = 0; i < allrooms.length; i ++) {
    $('#' + allrooms[i]).attr("fill", "none");
  }
  // highlight new
  for (var i = 0; i < newRooms.length; i ++) {
    $('#' + newRooms[i]).attr("fill", "#54AB67");
  }
}

function moveTo(room) {
  // magic numbers
  var windowWidth = 900; var windowHeight = 330;
  var FloorplanWidth = 2225; var FloorplanHeight = 3565;

  var xFraction = parseInt(roominfo[room].x)/115;
  var xPixels = (xFraction * FloorplanWidth) - windowWidth/2;

  var yFraction = parseInt(roominfo[room].y)/30;
  var yPixels = ( ( 1.0 - yFraction) * FloorplanHeight) - windowHeight/2 - 185;
  // final term accounts for height of floor in svg

  // flip
  xPixels = -xPixels; yPixels = -yPixels;

  // MOVE!
  $('.floorplan').css("transform", "translateY(" + yPixels + "px) translateX(" + xPixels + "px)");
}

/*
function updateOverlay(room) {
  $(".overlay .number").html(roominfo[room].number);
  $(".overlay .property .capacity").html(roominfo[room].capacity);
  $(".overlay .property .size").html(roominfo[room].size + " sq. ft.");
  $(".overlay .property .section").html(roominfo[room].section);
  $(".overlay .property .view").html(roominfo[room].view);

  // Bathroom Info requires some logic...
  var div = $(".overlay .property .bathroom");
  if (roominfo[room].bathroomType == 'internal') {
    div.html("Private");
  }
  else {
    if (roominfo[room].sharesBathroomWith.length == 1) {
        div.html("Unshared");
    }
    else {
      div.html("Shared between ");
      for (var i = 0; i < roominfo[room].sharesBathroomWith.length; i ++) {
        div.append(roominfo[room].sharesBathroomWith[i]);
        if (i < roominfo[room].sharesBathroomWith.length - 1) {
          div.append(", ");
        }
      }
    }
  }
}
*/

function applyFilters(results) {

  results = inDesiredSectionsAmong(results);

  if (consider == 'Available') { results = availableAmong(results); }

  if (desiredCapacity == 'Singles') { results = singlesAmong(results); }
  if (desiredCapacity == 'Doubles') { results = doublesAmong(results); }

  if (desiredView == 'Boston')    { results = bostonSideAmong(results);    }
  if (desiredView == 'Cambridge') { results = cambridgeSideAmong(results); }

  if (desiredWalls == 'Boxy')  { results = boxyWallsAmong(results);  }
  if (desiredWalls == 'Curvy') { results = curvyWallsAmong(results); }

  if (desiredBathroom == 'Shared')   { results = sharedBathroomsAmong(results);   }
  if (desiredBathroom == 'Unshared') { results = unsharedBathroomsAmong(results); }
  if (desiredBathroom == 'Private')  { results = privateBathroomsAmong(results);  }

  return results;
}

function updateDisplay() {
  results = applyFilters(allrooms);
  // results = sortBySize(results);
  updateCount(results);
  updateList(results);
  updateSvg(results);
  updateFloorplan(results);
}

// Helper:
function sortBySize(rooms) {
  rooms.sort(function(r1, r2) {
    return roominfo[r2].size - roominfo[r1].size;
  });
  return rooms;
}


/**********************************************
*                                             *
*               FILTER FUNCTIONS              *
*                                             *
**********************************************/

function sharedBathroomsAmong(rooms) {
  var sharedBathrooms = [];
  for (var i = 0; i < rooms.length; i ++) {
    if (roominfo[rooms[i]].sharesBathroomWith.length > 1) {
      sharedBathrooms.push(rooms[i]);
    }
  }
  return sharedBathrooms;
}

function unsharedBathroomsAmong(rooms) {
  var unsharedBathrooms = [];
  for (var i = 0; i < rooms.length; i ++) {
    if (roominfo[rooms[i]].sharesBathroomWith.length == 1) {
      unsharedBathrooms.push(rooms[i]);
    }
  }
  return unsharedBathrooms;
}

function privateBathroomsAmong(rooms) {
  var privateBathrooms = [];
  for (var i = 0; i < rooms.length; i ++) {
    if (roominfo[rooms[i]].bathroomType == 'internal') {
      privateBathrooms.push(rooms[i]);
    }
  }
  return privateBathrooms;
}

function availableAmong(rooms) {
  var available = [];
  for (var i = 0; i < rooms.length; i ++) {
    if (taken.indexOf(rooms[i]) == -1) {
      available.push(rooms[i]);
    }
  }
  return available;
}

function doublesAmong(rooms) {
  var doubles = [];
  for (var i = 0; i < rooms.length; i ++) {
    if (roominfo[rooms[i]].capacity == 'Double') {
      doubles.push(rooms[i]);
    }
  }
  return doubles;
}

function singlesAmong(rooms) {
  var singles = [];
  for (var i = 0; i < rooms.length; i ++) {
    if (roominfo[rooms[i]].capacity == 'Single') {
      singles.push(rooms[i]);
    }
  }
  return singles;
}

function inDesiredSectionsAmong(rooms) {
  var inDesiredSections = [];
  for (var i = 0; i < rooms.length; i ++) {
    section = roominfo[rooms[i]].section
    if (desiredSections.indexOf(section) != -1) {
      inDesiredSections.push(rooms[i]);
    }
  }
  return inDesiredSections;
}

function bostonSideAmong(rooms) {
  var bostonSide = [];
  for (var i = 0; i < rooms.length; i ++) {
    if (roominfo[rooms[i]].view == 'Boston') {
      bostonSide.push(rooms[i]);
    }
  }
  return bostonSide;
}

function cambridgeSideAmong(rooms) {
  var cambridgeSide = [];
  for (var i = 0; i < rooms.length; i ++) {
    if (roominfo[rooms[i]].view == 'Cambridge') {
      cambridgeSide.push(rooms[i]);
    }
  }
  return cambridgeSide;
}

function boxyWallsAmong(rooms) {
  var boxyWalls = [];
  for (var i = 0; i < rooms.length; i ++) {
    if (roominfo[rooms[i]].curvyWall == 'None') {
      boxyWalls.push(rooms[i]);
    }
  }
  return boxyWalls;
}

function curvyWallsAmong(rooms) {
  var curvyWalls = [];
  for (var i = 0; i < rooms.length; i ++) {
    if (roominfo[rooms[i]].curvyWall != 'None') {
      curvyWalls.push(rooms[i]);
    }
  }
  return curvyWalls;
}

/*********************************************/


function createTooltipFor(room) {
  var html = room + ' (' + roominfo[room].size + ' sq. ft. ' + roominfo[room].capacity + ')';
  return html;
}

function initializeSvg() {
  $('#Rooms').children().children().hide();
  $('#Facilities, #Dining, #Firestairs, #Laundry, #Kitchens, #Lounges').hide();

  // add titles for tipsy
  for (var i = 0; i < allrooms.length; i ++) {
    $('#r' + allrooms[i]).attr("title", createTooltipFor(allrooms[i]));
  }

  // apply tipsy
  $('#Rooms').children().children().tipsy({gravity: 'e', opacity: 1.0});
}



$(document).ready(function() {

  // load and initialize side-view
  $('.svg').append(svg);
  initializeSvg();

  // load floorplan svg
  $('.floorplan').append(floorplan_minimal_svg);

  // initialize to defaults
  updateDisplay(allrooms);

  // initialize (center) floorplan
  moveTo('1064');

  $('.btn-sideview').click(function() {
    $('.floorplans-container').hide();
  });

  $('.btn-topview').click(function() {
    $('.floorplans-container').show();
  });

  $('.btn-section').click(function() {
    $(this).toggleClass('engaged');
    section = $(this).attr('value');
    if (desiredSections.indexOf(section) == -1) {
      desiredSections.push(section);
    }
    else {
      var index = desiredSections.indexOf(section);
      desiredSections.splice(index, 1);
    }
  });

  $('.btn-toggleAllSections').click(function() {
    if (desiredSections.length > 0) {
      desiredSections = [];
      $(this).siblings().removeClass('engaged');
    }
    else {
      desiredSections = ['23AB', '34C', '4AB', '5AB', '6AB', '56C', '7ABC', '8910A', '8910B', '8910C'];
      $(this).siblings().addClass('engaged');
    }
  });

  $('.btn-doublesOnly').click(function() { desiredCapacity = 'Doubles'; });
  $('.btn-singlesOnly').click(function() { desiredCapacity = 'Singles'; });
  $('.btn-all').click(function() {         desiredCapacity = 'All';     });

  $('.btn-considerAll').click(function() { consider = 'All';       });
  $('.btn-available').click(function() {   consider = 'Available'; });

  $('.btn-bostonSideOnly').click(function() {    desiredView = 'Boston';    });
  $('.btn-cambridgeSideOnly').click(function() { desiredView = 'Cambridge'; });
  $('.btn-allSides').click(function() {          desiredView = 'All';       });

  $('.btn-boxyWallsOnly').click(function() {  desiredWalls = 'Boxy';  });
  $('.btn-curvyWallsOnly').click(function() { desiredWalls = 'Curvy'; });
  $('.btn-allWalls').click(function() {       desiredWalls = 'All';   });

  $('.btn-shared').click(function() {       desiredBathroom = 'Shared';   });
  $('.btn-unshared').click(function() {     desiredBathroom = 'Unshared'; });
  $('.btn-private').click(function() {      desiredBathroom = 'Private';  });
  $('.btn-allBathrooms').click(function() { desiredBathroom = 'All';      });

  $('.btn-select').click(function() {
    $(this).siblings().removeClass('engaged');
    $(this).addClass('engaged');
  });

  $('.btn').click(function() {
    updateDisplay();
  });

  $('.exit-overlay').click(function() {
    $('.overlay').hide();
  });

});

</script>

<div class="overlay" style="display: none;">
  <div class="number">839</div>

  <button class="btn exit-overlay">X</button>

  <!--
  <div class="floorplans-container">
    <div class="floorplan">
    </div>
  </div>
  -->

  <div class="property">
    <div class="label">Type</div>
    <div class="value capacity">Single</div>
  </div>
  <div class="property">
    <div class="label">Size</div>
    <div class="value size">161 sq ft</div>
  </div>
  <div class="property">
    <div class="label">Bathroom</div>
    <div class="value bathroom">Shared with 840</div>
  </div>
  <div class="property">
    <div class="label">Section</div>
    <div class="value section">C-Tower</div>
  </div>
  <div class="property">
    <div class="label">Side</div>
    <div class="value view">Cambridge</div>
  </div>
</div>

<div class="horz header">
  <div class="content">
    <div class="masthead">Filter</div>
    <div class="beta">BETA</div>
  </div>
</div>

<div class="horz filters">
  <div class="content">

    <!--
    <div class="controls">
      <div class="label">Consider</div>
      <button class="btn btn-select btn-consider engaged btn-considerAll">All Rooms</button>
      <button class="btn btn-select btn-consider engaged btn-available">Available Fall 2014</button>
    </div>
    -->

    <div class="controls">
      <div class="label">Type</div>
      <button class="btn btn-select engaged btn-all">All</button>
      <button class="btn btn-select btn-doublesOnly">Doubles</button>
      <button class="btn btn-select btn-singlesOnly">Singles</button>
    </div>

    <div class="controls">
      <div class="label">Side</div>
      <button class="btn btn-select engaged btn-allSides">All</button>
      <button class="btn btn-select btn-bostonSideOnly">Boston</button>
      <button class="btn btn-select btn-cambridgeSideOnly">Cambridge</button>
    </div>

    <div class="controls">
      <div class="label">Walls</div>
      <button class="btn btn-select engaged btn-allWalls">All</button>
      <button class="btn btn-select btn-boxyWallsOnly">Boxy</button>
      <button class="btn btn-select btn-curvyWallsOnly">Curvy</button>
    </div>

    <div class="controls">
      <div class="label">Bathroom</div>
      <button class="btn btn-select engaged btn-allBathrooms">All</button> 
      <button class="btn btn-select btn-shared">Shared</button>
      <button class="btn btn-select btn-unshared">Unshared*</button>
      <button class="btn btn-select btn-private">Private</button>
    </div>


    <div class="controls">
      <div class="label">Sections</div>
      <button class="btn btn-section engaged btn-23AB" value="23AB">2-3 AB</button>
      <button class="btn btn-section engaged btn-34C" value="34C">3-4 C</button>
      <button class="btn btn-section engaged btn-4AB" value="4AB">4 AB</button>
      <button class="btn btn-section engaged btn-5AB" value="5AB">5 AB</button>
      <button class="btn btn-section engaged btn-6AB" value="6AB">6 AB</button>
      <button class="btn btn-section engaged btn-56C" value="56C">5-6 C</button>
      <button class="btn btn-section engaged btn-7ABC" value="7ABC">7 ABC</button>
      <button class="btn btn-section engaged btn-8910A" value="8910A">A Tower</button>
      <button class="btn btn-section engaged btn-8910B" value="8910B">B Tower</button>
      <button class="btn btn-section engaged btn-8910C" value="8910C">C Tower</button>
      <button class="btn btn-toggleAllSections">Toggle All</button>
    </div>

    <div class="footnote">
      * : The bathroom is <i>outside</i> of the room, but not shared with any other room(s).
    </div>

  </div>
</div>

<div class="horz sideview">
  <div class="content">

    <div class="sideview-container">
      <div class="map">
        <div class="svg">
          <!-- from js/svg.js -->
        </div>
      </div>
    </div>

    <div class="floorplans-container">
      <div class="floorplan">
        <!-- from js/floorplan-minimal-svg.js -->
      </div>
    </div>

  </div>
</div>

<div class="horz results">
  <div class="content">

    <button class="btn-sideview">Side View</button>
    <button class="btn-topview">Top View</button>

    <div class="count"></div>
    <div class="explanation">sorted by square footage</div>
    <div class="lists">
      <div class="results-list-doubles-label">Doubles</div>
      <div class="results-list-doubles"></div>
      <div class="results-list-singles-label">Singles</div>
      <div class="results-list-singles"></div>
    </div>
  </div>
</div>

</body>
</html>
